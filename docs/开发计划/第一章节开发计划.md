# 《构造层》ARG游戏开发计划 - 第一章节：苏澜的遗物

## 📋 核心重构与设计理念

**双重体验核心**:
1.  **OS沉浸式探索**: PC端模拟真实Windows 10体验，手机端自适应为"远程桌面"App体验。
2.  **Galgame Narrative Layer**: 在关键节点触发视觉小说模式，通过对话框进行独白、思考和与"副本"的对话。

**故事范围**:
覆盖小说第1章到第4章，讲述玩家收到电脑，发现线索，接触CORE，最后与自己的意识副本对话的过程。

---

## 📅 章节流程设计 (Based on Novels 1-4)

### 阶段一：开箱与初步探索 (Chapter 1)
*   **入口**: 网页加载 -> 黑色ThinkPad开机画面 -> 无密码自动登录。
*   **初始状态**:
    *   时间：2024年11月3日 14:37 (锁定初始时间，或跟随真实时间但强制下午)。
    *   桌面文件：[工作文件]、[生活杂物]、[回收站]（空）。
    *   任务栏：Chrome, 微信, 网易云, VS Code。
    *   **Galgame层**: 首次进入桌面时，触发"旁白"模式：
        > "2024年11月3日。你收到一封用来取件的顺丰通知..." (Chapter 1 开头独白)
*   **关键交互**:
    *   **浏览文件**:
        *   `工作文件` -> `需求文档.pdf` (发现"苏澜"的名字)。
        *   `生活杂物` -> `追剧清单.txt`、`读书笔记.docx` (建立苏澜的人设：普通人)。
    *   **打开微信**: 查看"妈妈"、"阿景"、"小鱼"的聊天记录 (Confirm 失踪事实 & 时间点)。
    *   **打开Chrome**: 查看历史记录 (发现5月18日后的 `about:blank` 异常)。

### 阶段二：发现与质疑 (Chapter 1 End - Chapter 2)
*   **触发点**: 浏览完足够多的关键信息（微信+历史记录+工作文档）。
*   **事件**: 右下角弹出系统通知："系统提示：发现新的隐藏文件。是否查看？"
*   **交互**:
    *   玩家点击通知 -> 自动定位到 `工作文件/archive`。
    *   打开 `关于网络失踪案例的初步整理.pdf`。
    *   **Puzzle**: 翻到最后一页，没有任何异常。
    *   **Solution**: 玩家需要点击PDF阅读器的"图层"按钮（或类似"查看备注"功能），显示隐藏文字。
    *   **Narrative**: 触发独白："如果能通过某种方式看到隐藏层..." -> 发现苏澜的自白："那8个人，都是我。"

### 阶段三：CORE与序列 (Chapter 3)
*   **线索指引**: PDF隐藏文字提示去找 `sequence.txt`。
*   **交互**:
    *   打开VS Code -> 最近文件 -> 点击 `sequence.txt`。
    *   发现 `.system` 隐藏文件夹被挂载。
    *   查看 `sequence.txt` (访问序列)、`draft_8.txt` (关于第8步的猜想)。
    *   查看 `observer.exe` (无法运行，但右键属性揭示CORE系统)。
    *   **Time Skip**: 时间流逝加速，天色变暗 (UI变暗/夜间模式)。
*   **Meta Horror**:
    *   打开 `CORE_README.txt`。
    *   看到实时跳动的百分比："你的数字人格模型完整度：34%..."
    *   任务管理器发现无法关闭 `observer.exe`。

### 阶段四：镜像与自我 (Chapter 3 End - Chapter 4)
*   **高潮触发**: 发现 `VirtualBox` -> `Mirror.vbox`。
*   **交互**:
    *   启动虚拟机。
    *   虚拟机内的PDF多了一个案例：**案例9 苏澜**。
    *   虚拟机内的Chrome历史记录显示了**玩家刚才的操作** (Break the 4th Wall)。
    *   **Test**: 在外部创建 `question.txt` 写入"我是谁"，虚拟机内同步出现。
*   **结局**:
    *   屏幕闪烁，进入纯黑。
    *   **Boss Battle (Dialogue)**: 与"意识副本"的对话。
        *   Galgame模式全屏覆盖。
        *   对话选择题：
            *   "你是谁？"
            *   "你能证明吗？"
            *   "我的结局是什么？"
    *   **查看真相**: 副本指引去 `memory_fragments`，发现文件夹 `2024-11-03_[玩家名]`。
    *   **Final Choice**:
        1.  **关机** (退出游戏，清除本地存档，"遗忘")。
        2.  **等待** (挂机直到100%，解锁成就"共存")。
        3.  **执行序列** (在凌晨3:17执行操作 -> 进入Chapter 2开发预告)。

---

## 🎮 核心交互系统设计

### 1. 存档系统 (Save System)
为了配合"OS模拟"的真实感，不使用传统的"ESC -> 保存游戏"菜单。
*   **自动存档**: 系统的任何状态变化（文件打开、阅读进度、flag触发）实时写入 `localStorage`。
*   **"系统快照"**:
    *   在"我的电脑"右键属性中，有一个"创建系统还原点"的按钮（手动存档）。
    *   如果玩家处于"危险状态"（如Chapter 4对话失败），可能会自动加载还原点。
*   **Meta存档**:
    *   `identity_log.txt` 实际上就是存档文件的可视化表现。
    *   如果玩家删除了 `identity_log.txt`，可能导致游戏重置（Hard Reset）。

### 2. 线索提交与解谜 (Clue Submission)
不使用"背包"或"道具栏"。线索就是**信息**。
*   **自动记录**: 当玩家看到关键信息（如"文三路127号"），系统会在后台记录 `discovered_clues`。
*   **主动输入**:
    *   在记事本中输入关键词，或者在浏览器地址栏输入特定URL，触发剧情。
    *   Example: 输入 `about:blank` 是后续章节的关键。
*   **文件操作解谜**:
    *   修改文件名、移动文件、显示隐藏文件、查看属性、PDF图层切换。

### 3. 剧情推进机制 (Narrative Progression)
*   **State Machine (状态机)**:
    *   `Idle`: 自由探索。
    *   `Narrative`: 锁死操作，弹出Galgame对话框（独白/对话）。
    *   `Glitch`: 屏幕闪烁，UI错位（CORE干扰）。
*   **Trigger**:
    *   **Files**: 打开特定文件 (e.g., `CORE_README.txt`)。
    *   **Time**: 系统时间达到特定点 (e.g., 23:14)。
    *   **Action**: 尝试关闭关键进程。

---

## 📱 移动端/沉浸式适配方案

为了保证手机上有Galgame体验，同时保留OS探索：
1.  **竖屏模式 (Mobile)**:
    *   **UI布局**: 类似手机版"远程桌面"App。
    *   **窗口**: 默认**全屏化**。点击任务栏图标切换App。
    *   **对话**: 底部弹出式Galgame对话框（半高），不遮挡关键信息。
2.  **横屏模式 (PC/Tablet)**:
    *   **UI布局**: 标准Windows 10桌面。
    *   **窗口**: 可拖拽、缩放。
    *   **对话**: 屏幕中央或底部浮层。

---

## 🛠️ 技术实现清单 (Revision)

### 1. 新增 Narrator System
*   **`NarrativeOverlay` 组件**:
    *   覆盖在OS层之上。
    *   支持打字机效果、点击继续、自动播放。
    *   支持特殊演出：闪屏、黑屏、背景模糊。

### 2. 增强 FileSystem
*   **支持 Hidden 属性**: `.system` 文件夹默认不渲染，除非开启设置。
*   **支持 Metadata**: 文件创建时间、修改时间必须精确匹配小说。
*   **虚拟 Content**: `observer.exe` 不需要真的跑exe，但要有 `属性` 面板逻辑。

### 3. 增强 Browser
*   **History Manager**: 预填充大量历史记录。
*   **Address Bar Trap**: 输入特定网址触发事件。

### 4. 虚拟机 (VirtualBox) 模拟
*   **嵌套桌面**:
    *   实现一个 `VirtualMachineApp`，里面渲染另一个简化版的 `Desktop` 组件。
    *   或者偷懒做法：全屏切换 `Wallpaper` 和 `FileSystem` 上下文，模拟"进入了虚拟机"。

## 📝 待办任务建议
1.  [x] 完成基础Mobile适配。
2.  [ ] **Content**: 将小说Ch1-Ch4的所有文本提取并通过脚本注入到FileSystem。
3.  [ ] **Feature**: 实现PDF阅读器的"图层切换"功能（或者简化为点击按钮显示隐藏内容）。
4.  [ ] **Feature**: 实现Chrome的历史记录界面。
5.  [ ] **Feature**: 实现Chapter 4的"人机对话"逻辑。

---
**Next Step**: 更新项目中的文档，并开始按此计划填充内容。
