# ã€Šæ„é€ å±‚ã€‹æ¸¸æˆç³»ç»Ÿæ•´ä½“æ¶æ„è®¾è®¡

## ğŸ“± æ ¸å¿ƒå®šä½è°ƒæ•´

**ä¸»è¦å¹³å°**: ç§»åŠ¨ç«¯ä¼˜å…ˆ (Mobile First)
**æ¬¡è¦å¹³å°**: æ¡Œé¢ç«¯é€‚é…
**æ ¸å¿ƒä½“éªŒ**: æ²‰æµ¸å¼è®¾å¤‡æ“ä½œ + è§†è§‰å°è¯´å¯¹è¯ç³»ç»Ÿ

---

## ğŸ¯ ç³»ç»Ÿæ¶æ„æ€»è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ¬¢è¿é¡µç³»ç»Ÿ                          â”‚
â”‚  - å¼€å§‹æ¸¸æˆ / ç»§ç»­æ¸¸æˆ / ç« èŠ‚é€‰æ‹©                        â”‚
â”‚  - å¼•å­å‰§æƒ… / æˆå°±ç³»ç»Ÿ / è®¾ç½®                            â”‚
â”‚  - IndexedDBæœ¬åœ°å­˜æ¡£ç®¡ç†                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ¸¸æˆæ ¸å¿ƒå¼•æ“                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ åœºæ™¯ç®¡ç†å™¨   â”‚  â”‚  çŠ¶æ€ç®¡ç†å™¨  â”‚  â”‚  äº‹ä»¶æ€»çº¿    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ²‰æµ¸å¼æ“ä½œç³»ç»Ÿ       â”‚      è§†è§‰å°è¯´ç³»ç»Ÿ               â”‚
â”‚                       â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ç§»åŠ¨è®¾å¤‡ç•Œé¢     â”‚ â”‚  â”‚  å¯¹è¯æ¡†ç³»ç»Ÿ              â”‚  â”‚
â”‚  â”‚ - æ‰‹æœºä¸»å±å¹•     â”‚ â”‚  â”‚  - äººç‰©ç«‹ç»˜              â”‚  â”‚
â”‚  â”‚ - åº”ç”¨å›¾æ ‡       â”‚ â”‚  â”‚  - æ–‡å­—æ¡†                â”‚  â”‚
â”‚  â”‚ - é€šçŸ¥æ          â”‚ â”‚  â”‚  - é€‰é¡¹åˆ†æ”¯              â”‚  â”‚
â”‚  â”‚ - çŠ¶æ€æ          â”‚ â”‚  â”‚  - è‡ªåŠ¨æ’­æ”¾              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                       â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ åº”ç”¨æ¨¡æ‹Ÿå™¨       â”‚ â”‚  â”‚  æ¼”å‡ºç³»ç»Ÿ                â”‚  â”‚
â”‚  â”‚ - å¾®ä¿¡/QQ       â”‚ â”‚  â”‚  - åœºæ™¯è½¬åœº              â”‚  â”‚
â”‚  â”‚ - æµè§ˆå™¨        â”‚ â”‚  â”‚  - ç‰¹æ•ˆåŠ¨ç”»              â”‚  â”‚
â”‚  â”‚ - æ–‡ä»¶ç®¡ç†å™¨     â”‚ â”‚  â”‚  - BGM/SE               â”‚  â”‚
â”‚  â”‚ - ç›¸å†Œ          â”‚ â”‚  â”‚  - å±å¹•éœ‡åŠ¨              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                       â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ äº¤äº’æ£€æµ‹å™¨       â”‚ â”‚  â”‚  å‰§æƒ…æ¨è¿›å™¨              â”‚  â”‚
â”‚  â”‚ - ç‚¹å‡»è¿½è¸ª       â”‚ â”‚  â”‚  - æ¡ä»¶è§¦å‘              â”‚  â”‚
â”‚  â”‚ - æ»‘åŠ¨æ“ä½œ       â”‚ â”‚  â”‚  - å˜é‡ç³»ç»Ÿ              â”‚  â”‚
â”‚  â”‚ - é•¿æŒ‰è¯†åˆ«       â”‚ â”‚  â”‚  - Flagç®¡ç†             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æ”¯æ’‘ç³»ç»Ÿ                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ æˆå°±ç³»ç»Ÿ     â”‚  â”‚  å­˜æ¡£ç³»ç»Ÿ    â”‚  â”‚  èµ„æºåŠ è½½å™¨  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ æŠ€æœ¯æ ˆé€‰å‹

### æ ¸å¿ƒæ¡†æ¶
```json
{
  "framework": "React 18+",
  "language": "TypeScript",
  "stateManagement": "Zustand (è½»é‡çº§çŠ¶æ€ç®¡ç†)",
  "router": "React Router v6",
  "animation": "Framer Motion",
  "database": "IndexedDB (Dexie.jså°è£…)",
  "build": "Vite",
  "ui": "Tailwind CSS + HeadlessUI"
}
```

### ç§»åŠ¨ç«¯ä¼˜åŒ–
```json
{
  "viewport": "react-use (useViewportSize)",
  "touch": "react-use-gesture (æ‰‹åŠ¿åº“)",
  "pwa": "vite-plugin-pwa (ç¦»çº¿æ”¯æŒ)",
  "performance": "React.lazy + Suspense (ä»£ç åˆ†å‰²)"
}
```

---

## ğŸ—ï¸ é¡¹ç›®ç›®å½•ç»“æ„

```
interactive-game/
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ assets/
â”‚   â”‚   â”œâ”€â”€ images/          # ç«‹ç»˜ã€èƒŒæ™¯ã€UIç´ æ
â”‚   â”‚   â”œâ”€â”€ audio/           # BGMã€SEéŸ³æ•ˆ
â”‚   â”‚   â””â”€â”€ fonts/           # å­—ä½“æ–‡ä»¶
â”‚   â””â”€â”€ manifest.json        # PWAé…ç½®
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.tsx            # å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ App.tsx             # æ ¹ç»„ä»¶
â”‚   â”‚
â”‚   â”œâ”€â”€ core/               # æ ¸å¿ƒå¼•æ“
â”‚   â”‚   â”œâ”€â”€ SceneManager.ts          # åœºæ™¯ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ EventBus.ts              # äº‹ä»¶æ€»çº¿
â”‚   â”‚   â”œâ”€â”€ StateManager.ts          # å…¨å±€çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ SaveSystem.ts            # å­˜æ¡£ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ AchievementSystem.ts    # æˆå°±ç³»ç»Ÿ
â”‚   â”‚   â””â”€â”€ ResourceLoader.ts        # èµ„æºåŠ è½½
â”‚   â”‚
â”‚   â”œâ”€â”€ systems/            # æ¸¸æˆç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ dialogue/                # å¯¹è¯ç³»ç»Ÿ
â”‚   â”‚   â”‚   â”œâ”€â”€ DialogueBox.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ CharacterSprite.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ChoiceButton.tsx
â”‚   â”‚   â”‚   â””â”€â”€ DialogueParser.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ device/                  # è®¾å¤‡æ¨¡æ‹Ÿç³»ç»Ÿ
â”‚   â”‚   â”‚   â”œâ”€â”€ MobileOS/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ HomeScreen.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ StatusBar.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ NotificationPanel.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ AppDrawer.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ DesktopOS/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Desktop.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Taskbar.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ WindowManager.tsx
â”‚   â”‚   â”‚   â””â”€â”€ OSContext.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ apps/                    # åº”ç”¨æ¨¡æ‹Ÿå™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ WeChat/
â”‚   â”‚   â”‚   â”œâ”€â”€ Browser/
â”‚   â”‚   â”‚   â”œâ”€â”€ FileManager/
â”‚   â”‚   â”‚   â”œâ”€â”€ Gallery/
â”‚   â”‚   â”‚   â””â”€â”€ Notes/
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ effects/                 # æ¼”å‡ºç³»ç»Ÿ
â”‚   â”‚       â”œâ”€â”€ SceneTransition.tsx
â”‚   â”‚       â”œâ”€â”€ ScreenShake.tsx
â”‚   â”‚       â””â”€â”€ AudioManager.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ pages/              # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Welcome/                 # æ¬¢è¿é¡µ
â”‚   â”‚   â”‚   â”œâ”€â”€ WelcomePage.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ IntroSequence.tsx    # å¼•å­åŠ¨ç”»
â”‚   â”‚   â”‚   â”œâ”€â”€ MainMenu.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ChapterSelect.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ AchievementView.tsx
â”‚   â”‚   â”‚   â””â”€â”€ SettingsPanel.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ Game/                    # æ¸¸æˆä¸»é¡µé¢
â”‚   â”‚       â”œâ”€â”€ GameContainer.tsx
â”‚   â”‚       â””â”€â”€ SceneRenderer.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ data/               # æ¸¸æˆæ•°æ®
â”‚   â”‚   â”œâ”€â”€ chapters/                # ç« èŠ‚è„šæœ¬
â”‚   â”‚   â”‚   â”œâ”€â”€ chapter1.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ chapter2.ts
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ characters.ts            # è§’è‰²æ•°æ®
â”‚   â”‚   â”œâ”€â”€ achievements.ts          # æˆå°±å®šä¹‰
â”‚   â”‚   â””â”€â”€ constants.ts             # å¸¸é‡é…ç½®
â”‚   â”‚
â”‚   â”œâ”€â”€ stores/             # çŠ¶æ€å­˜å‚¨
â”‚   â”‚   â”œâ”€â”€ useGameStore.ts          # æ¸¸æˆä¸»çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ useDialogueStore.ts      # å¯¹è¯çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ useDeviceStore.ts        # è®¾å¤‡çŠ¶æ€
â”‚   â”‚   â””â”€â”€ useAchievementStore.ts   # æˆå°±çŠ¶æ€
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/              # è‡ªå®šä¹‰Hooks
â”‚   â”‚   â”œâ”€â”€ useSceneTransition.ts
â”‚   â”‚   â”œâ”€â”€ useSaveLoad.ts
â”‚   â”‚   â”œâ”€â”€ useDeviceDetect.ts
â”‚   â”‚   â””â”€â”€ useAudio.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/              # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ db.ts                    # IndexedDBå°è£…
â”‚   â”‚   â”œâ”€â”€ logger.ts
â”‚   â”‚   â””â”€â”€ format.ts
â”‚   â”‚
â”‚   â””â”€â”€ types/              # TypeScriptç±»å‹
â”‚       â”œâ”€â”€ game.d.ts
â”‚       â”œâ”€â”€ dialogue.d.ts
â”‚       â””â”€â”€ device.d.ts
â”‚
â”œâ”€â”€ docs/                   # æ–‡æ¡£
â””â”€â”€ package.json
```

---

## ğŸ¨ æ¬¢è¿é¡µç³»ç»Ÿè®¾è®¡

### é¡µé¢ç»“æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         èƒŒæ™¯åŠ¨ç”»/è§†é¢‘            â”‚
â”‚                                  â”‚
â”‚      ã€Šæ„é€ å±‚ã€‹LOGO              â”‚
â”‚                                  â”‚
â”‚    [å¼€å§‹æ¸¸æˆ] [ç»§ç»­æ¸¸æˆ]         â”‚
â”‚                                  â”‚
â”‚    [ç« èŠ‚é€‰æ‹©] [æˆå°±] [è®¾ç½®]     â”‚
â”‚                                  â”‚
â”‚    ç‰ˆæœ¬å· | è¿›åº¦: 34%            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åŠŸèƒ½æ¨¡å—

#### 1. ä¸»èœå•
```tsx
interface MainMenuProps {
  hasExistingSave: boolean;
  completionPercentage: number;
}

// æŒ‰é’®çŠ¶æ€
type MenuButton =
  | 'start'      // æ–°æ¸¸æˆ
  | 'continue'   // ç»§ç»­æ¸¸æˆ (æœ‰å­˜æ¡£æ—¶å¯ç”¨)
  | 'chapters'   // ç« èŠ‚é€‰æ‹© (è§£é”åå¯ç”¨)
  | 'achievements' // æˆå°±ç³»ç»Ÿ
  | 'settings'   // è®¾ç½®é¢æ¿
  | 'intro';     // é‡çœ‹å¼•å­
```

#### 2. å¼•å­ç³»ç»Ÿ
**å¼•å­å†…å®¹**:
```
é»‘å± â†’ æ‰“å­—æœºæ•ˆæœæ–‡å­—
"åœ¨äº’è”ç½‘çš„æ·±å¤„ï¼Œæ²¡æœ‰æ­»äº¡ï¼Œåªæœ‰é—å¿˜ã€‚"
â†’ æ·¡å…¥æ„é€ å±‚è§†è§‰åŒ–å›¾åƒ
â†’ æ ¸å¿ƒè®¾å®šæ–‡å­—å±•ç¤º
â†’ æ·¡å‡ºè¿›å…¥ä¸»èœå•
```

**è·³è¿‡æœºåˆ¶**:
- é¦–æ¬¡è¿›å…¥: å¼ºåˆ¶æ’­æ”¾
- å†æ¬¡è®¿é—®: å³ä¸Šè§’æ˜¾ç¤º"è·³è¿‡"æŒ‰é’®
- å¯åœ¨è®¾ç½®ä¸­é‡æ–°è§‚çœ‹

#### 3. ç« èŠ‚é€‰æ‹©
```tsx
interface ChapterData {
  id: number;
  title: string;
  subtitle: string;
  locked: boolean;
  completed: boolean;
  thumbnail: string;
  unlockCondition?: string;
}

// ç¤ºä¾‹æ•°æ®
const chapters = [
  {
    id: 1,
    title: "ç¬¬ä¸€ç« ",
    subtitle: "å¿«é€’",
    locked: false,
    completed: true,
    thumbnail: "/assets/chapter1.jpg"
  },
  {
    id: 2,
    title: "ç¬¬äºŒç« ",
    subtitle: "è‹æ¾œ",
    locked: false,
    completed: false,
    thumbnail: "/assets/chapter2.jpg"
  },
  // ...
];
```

#### 4. å­˜æ¡£ç³»ç»Ÿ
```tsx
interface SaveData {
  id: string;
  timestamp: Date;
  chapterId: number;
  sceneId: string;

  // æ¸¸æˆè¿›åº¦
  gameState: {
    flags: Record<string, boolean>;
    variables: Record<string, any>;
    filesOpened: string[];
    achievements: string[];
  };

  // è®¾å¤‡çŠ¶æ€
  deviceState: {
    currentOS: 'mobile' | 'desktop';
    apps: AppState[];
    notifications: Notification[];
  };

  // å¯¹è¯çŠ¶æ€
  dialogueState: {
    currentNode: string;
    history: string[];
    choices: Choice[];
  };

  // å…ƒæ•°æ®
  metadata: {
    playTime: number; // æ€»æ¸¸ç©æ—¶é•¿(ç§’)
    saveCount: number;
    version: string;
  };
}

// è‡ªåŠ¨å­˜æ¡£è§¦å‘ç‚¹
const AUTO_SAVE_TRIGGERS = [
  'chapter_complete',
  'major_choice_made',
  'achievement_unlocked',
  'every_5_minutes'
];
```

---

## ğŸ’¬ è§†è§‰å°è¯´å¯¹è¯ç³»ç»Ÿ

### å¯¹è¯æ¡†æ¶æ„

```tsx
interface DialogueNode {
  id: string;
  type: 'narration' | 'dialogue' | 'choice' | 'system';

  // æ–‡æœ¬å†…å®¹
  content: string;
  speaker?: {
    name: string;
    sprite?: string; // ç«‹ç»˜èµ„æºè·¯å¾„
    emotion?: 'normal' | 'happy' | 'sad' | 'angry' | 'surprised';
  };

  // æ¼”å‡ºæ§åˆ¶
  effects?: {
    bgm?: string;
    se?: string;
    background?: string;
    screenShake?: boolean;
    transition?: 'fade' | 'slide' | 'glitch';
  };

  // åˆ†æ”¯é€‰é¡¹
  choices?: {
    text: string;
    next: string; // ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ID
    condition?: string; // æ¡ä»¶è¡¨è¾¾å¼
    effect?: () => void; // å‰¯ä½œç”¨(è®¾ç½®flagç­‰)
  }[];

  // ä¸‹ä¸€èŠ‚ç‚¹
  next?: string;

  // è§¦å‘å™¨
  triggers?: {
    onEnter?: () => void;
    onExit?: () => void;
  };
}
```

### å¯¹è¯è„šæœ¬ç¤ºä¾‹

```typescript
// data/chapters/chapter1.ts
export const chapter1Dialogue: DialogueNode[] = [
  {
    id: 'ch1_001',
    type: 'narration',
    content: '2024å¹´11æœˆ3æ—¥ï¼Œä½ æ”¶åˆ°ä¸€å°æ¥è‡ªé¡ºä¸°å¿«é€’çš„å–ä»¶é€šçŸ¥ã€‚',
    effects: {
      bgm: 'bgm_mystery_01.mp3',
      background: 'bg_apartment.jpg'
    },
    next: 'ch1_002'
  },
  {
    id: 'ch1_002',
    type: 'narration',
    content: 'å¯„ä»¶äººï¼šæ—ç§‹ï¼ˆåœ°å€ï¼šæ­å·å¸‚è¥¿æ¹–åŒºæ–‡ä¸‰è·¯127å·ï¼‰\næ”¶ä»¶äººï¼šä½ çš„çœŸå®å§“å\nç‰©å“ï¼šä¸ªäººç‰©å“ä¸€ç®±',
    next: 'ch1_003'
  },
  {
    id: 'ch1_003',
    type: 'narration',
    content: 'ä½ å¹¶ä¸è®¤è¯†ä»€ä¹ˆæ—ç§‹ã€‚',
    next: 'ch1_choice_001'
  },
  {
    id: 'ch1_choice_001',
    type: 'choice',
    content: 'è¦å»å–ä»¶å—ï¼Ÿ',
    choices: [
      {
        text: 'å»å–ä»¶çœ‹çœ‹',
        next: 'ch1_004',
        effect: () => setFlag('took_package', true)
      },
      {
        text: 'ä¸ç®¡å®ƒ',
        next: 'ch1_ignore',
        effect: () => setFlag('ignored_package', true)
      }
    ]
  },
  // ... æ›´å¤šèŠ‚ç‚¹
];
```

### UIç»„ä»¶è®¾è®¡

#### å¯¹è¯æ¡† (DialogueBox)
```tsx
interface DialogueBoxProps {
  content: string;
  speaker?: {
    name: string;
    emotion: string;
  };
  isNarration: boolean;
  onNext: () => void;
  autoPlay?: boolean;
}

// ç§»åŠ¨ç«¯å¸ƒå±€
<div className="fixed bottom-0 left-0 right-0 p-4 bg-black/80">
  {speaker && (
    <div className="text-white font-bold mb-2">{speaker.name}</div>
  )}
  <div className="text-white leading-relaxed">
    {displayedText} {/* æ‰“å­—æœºæ•ˆæœ */}
  </div>
  <div className="flex justify-end mt-2">
    <button onClick={onNext}>â–¼</button>
  </div>
</div>
```

#### é€‰é¡¹æŒ‰é’® (ChoiceButton)
```tsx
<div className="fixed inset-x-0 bottom-20 p-4 space-y-2">
  {choices.map((choice, index) => (
    <button
      key={index}
      className="w-full bg-blue-600 text-white py-3 rounded-lg
                 active:bg-blue-700 transition-colors"
      onClick={() => handleChoice(choice)}
    >
      {choice.text}
    </button>
  ))}
</div>
```

#### ç«‹ç»˜ç³»ç»Ÿ (CharacterSprite)
```tsx
interface SpritePosition {
  left: string;
  center: string;
  right: string;
}

// ç§»åŠ¨ç«¯è‡ªé€‚åº”å¸ƒå±€
<div className="fixed inset-0 pointer-events-none">
  {characters.map((char) => (
    <img
      key={char.id}
      src={char.sprite}
      className={`absolute bottom-0 ${positionClass[char.position]}
                  transform transition-all duration-300
                  ${char.active ? 'scale-105 brightness-100' : 'scale-100 brightness-75'}`}
      style={{
        height: '80vh',
        objectFit: 'contain'
      }}
    />
  ))}
</div>
```

---

## ğŸ“± ç§»åŠ¨è®¾å¤‡æ“ä½œç³»ç»Ÿæ¨¡æ‹Ÿ

### æ‰‹æœºä¸»å±å¹• (HomeScreen)

```tsx
interface MobileApp {
  id: string;
  name: string;
  icon: string;
  badge?: number; // çº¢ç‚¹æç¤º
  locked?: boolean;
  component: React.ComponentType;
}

const defaultApps: MobileApp[] = [
  { id: 'wechat', name: 'å¾®ä¿¡', icon: '/icons/wechat.png', component: WeChatApp },
  { id: 'browser', name: 'æµè§ˆå™¨', icon: '/icons/browser.png', component: BrowserApp },
  { id: 'files', name: 'æ–‡ä»¶ç®¡ç†', icon: '/icons/files.png', component: FileManagerApp },
  { id: 'gallery', name: 'ç›¸å†Œ', icon: '/icons/gallery.png', component: GalleryApp },
  { id: 'notes', name: 'å¤‡å¿˜å½•', icon: '/icons/notes.png', component: NotesApp },
];

// ç§»åŠ¨ç«¯å¸ƒå±€
<div className="h-screen bg-gradient-to-b from-blue-400 to-blue-600">
  {/* çŠ¶æ€æ  */}
  <StatusBar time={systemTime} battery={90} signal={4} />

  {/* åº”ç”¨å›¾æ ‡ç½‘æ ¼ */}
  <div className="grid grid-cols-4 gap-4 p-6">
    {apps.map((app) => (
      <AppIcon
        key={app.id}
        {...app}
        onClick={() => openApp(app.id)}
      />
    ))}
  </div>

  {/* Dockæ  */}
  <div className="fixed bottom-4 left-4 right-4 bg-white/20 backdrop-blur
                  rounded-2xl p-3 flex justify-around">
    <AppIcon {...phoneApp} />
    <AppIcon {...messageApp} />
    <AppIcon {...browserApp} />
  </div>
</div>
```

### åº”ç”¨æ¡†æ¶ (AppContainer)

```tsx
interface AppContainerProps {
  appId: string;
  title: string;
  onClose: () => void;
  children: React.ReactNode;
}

<div className="fixed inset-0 bg-white z-50 flex flex-col">
  {/* åº”ç”¨å¤´éƒ¨ */}
  <div className="h-14 bg-gray-100 flex items-center px-4 border-b">
    <button onClick={onClose}>
      <ArrowLeft />
    </button>
    <span className="ml-4 font-medium">{title}</span>
  </div>

  {/* åº”ç”¨å†…å®¹ */}
  <div className="flex-1 overflow-auto">
    {children}
  </div>
</div>
```

### å¾®ä¿¡æ¨¡æ‹Ÿ (WeChatApp)

```tsx
interface ChatMessage {
  id: string;
  sender: 'me' | 'other';
  senderName: string;
  avatar: string;
  content: string;
  timestamp: Date;
  type: 'text' | 'image' | 'file';
  read: boolean;
}

interface ChatConversation {
  id: string;
  name: string;
  avatar: string;
  lastMessage: string;
  timestamp: Date;
  unread: number;
  messages: ChatMessage[];
}

// èŠå¤©åˆ—è¡¨
<div className="divide-y">
  {conversations.map((conv) => (
    <div
      key={conv.id}
      className="flex items-center p-4 active:bg-gray-100"
      onClick={() => openChat(conv.id)}
    >
      <Avatar src={conv.avatar} size={48} />
      <div className="flex-1 ml-3">
        <div className="flex justify-between">
          <span className="font-medium">{conv.name}</span>
          <span className="text-xs text-gray-500">
            {formatTime(conv.timestamp)}
          </span>
        </div>
        <div className="text-sm text-gray-600 truncate">
          {conv.lastMessage}
        </div>
      </div>
      {conv.unread > 0 && (
        <div className="ml-2 bg-red-500 text-white rounded-full
                        w-5 h-5 flex items-center justify-center text-xs">
          {conv.unread}
        </div>
      )}
    </div>
  ))}
</div>
```

---

## ğŸ† æˆå°±ç³»ç»Ÿ

### æˆå°±æ•°æ®ç»“æ„

```typescript
interface Achievement {
  id: string;
  title: string;
  description: string;
  icon: string;

  // è§£é”æ¡ä»¶
  condition: {
    type: 'flag' | 'count' | 'time' | 'custom';
    target: string;
    value?: number;
    check?: () => boolean;
  };

  // å¥–åŠ±
  reward?: {
    type: 'unlockChapter' | 'unlockEnding' | 'cosmetic';
    value: string;
  };

  // çŠ¶æ€
  unlocked: boolean;
  unlockedAt?: Date;
  hidden: boolean; // éšè—æˆå°±
  progress?: number; // è¿›åº¦ç™¾åˆ†æ¯”
}

// ç¤ºä¾‹æˆå°±
const achievements: Achievement[] = [
  {
    id: 'ach_first_boot',
    title: 'åˆæ¬¡å¯åŠ¨',
    description: 'ç¬¬ä¸€æ¬¡æ‰“å¼€è‹æ¾œçš„ç”µè„‘',
    icon: '/icons/ach_boot.png',
    condition: {
      type: 'flag',
      target: 'system_booted'
    },
    unlocked: false,
    hidden: false
  },
  {
    id: 'ach_explorer',
    title: 'å¥½å¥‡å¿ƒ',
    description: 'æ‰“å¼€æ‰€æœ‰æ¡Œé¢æ–‡ä»¶å¤¹',
    icon: '/icons/ach_explorer.png',
    condition: {
      type: 'count',
      target: 'folders_opened',
      value: 10
    },
    unlocked: false,
    hidden: false,
    progress: 30
  },
  {
    id: 'ach_truth_seeker',
    title: 'çœŸç›¸è¿½å¯»è€…',
    description: 'å‘ç°PDFéšè—å›¾å±‚',
    icon: '/icons/ach_truth.png',
    condition: {
      type: 'flag',
      target: 'pdf_layer_revealed'
    },
    unlocked: false,
    hidden: true // å‰§é€ä¿æŠ¤
  },
  {
    id: 'ach_speed_runner',
    title: 'é€Ÿé€šè€…',
    description: 'åœ¨30åˆ†é’Ÿå†…å®Œæˆç¬¬ä¸€ç« ',
    icon: '/icons/ach_speed.png',
    condition: {
      type: 'time',
      target: 'chapter1_complete',
      value: 1800 // ç§’
    },
    unlocked: false,
    hidden: false
  }
];
```

### æˆå°±UIç»„ä»¶

```tsx
// æˆå°±åˆ—è¡¨é¡µé¢
<div className="p-4 space-y-3">
  <div className="text-center mb-6">
    <div className="text-3xl font-bold">{unlockedCount}/{totalCount}</div>
    <div className="text-gray-500">å·²è§£é”æˆå°±</div>
    <div className="mt-2 bg-gray-200 rounded-full h-2">
      <div
        className="bg-blue-500 h-2 rounded-full transition-all"
        style={{ width: `${(unlockedCount / totalCount) * 100}%` }}
      />
    </div>
  </div>

  {achievements.map((ach) => (
    <AchievementCard key={ach.id} {...ach} />
  ))}
</div>

// æˆå°±å¡ç‰‡
<div className={`p-4 rounded-lg border-2 ${
  unlocked ? 'border-yellow-500 bg-yellow-50' : 'border-gray-300 bg-gray-50'
}`}>
  <div className="flex items-start">
    <img
      src={unlocked || !hidden ? icon : '/icons/locked.png'}
      className={`w-12 h-12 ${!unlocked && 'grayscale'}`}
    />
    <div className="ml-3 flex-1">
      <div className="font-medium">
        {unlocked || !hidden ? title : '???'}
      </div>
      <div className="text-sm text-gray-600">
        {unlocked || !hidden ? description : 'éšè—æˆå°±'}
      </div>
      {progress !== undefined && !unlocked && (
        <div className="mt-2 bg-gray-200 rounded-full h-1">
          <div
            className="bg-blue-500 h-1 rounded-full"
            style={{ width: `${progress}%` }}
          />
        </div>
      )}
    </div>
    {unlocked && (
      <div className="text-xs text-gray-500">
        {formatDate(unlockedAt)}
      </div>
    )}
  </div>
</div>

// æˆå°±è§£é”å¼¹çª—
<div className="fixed top-20 left-1/2 transform -translate-x-1/2
                bg-gradient-to-r from-yellow-400 to-yellow-600
                text-white px-6 py-3 rounded-full shadow-lg
                animate-bounce">
  <div className="flex items-center space-x-3">
    <Trophy className="w-6 h-6" />
    <div>
      <div className="text-sm font-medium">æˆå°±è§£é”ï¼</div>
      <div className="text-xs">{achievement.title}</div>
    </div>
  </div>
</div>
```

---

## ğŸ® æ¸¸æˆæµç¨‹æ§åˆ¶

### åœºæ™¯ç®¡ç†å™¨ (SceneManager)

```typescript
type SceneType =
  | 'welcome'        // æ¬¢è¿é¡µ
  | 'intro'          // å¼•å­
  | 'dialogue'       // å¯¹è¯åœºæ™¯
  | 'device'         // è®¾å¤‡æ“ä½œåœºæ™¯
  | 'mixed';         // æ··åˆåœºæ™¯(å¯¹è¯+è®¾å¤‡)

interface Scene {
  id: string;
  type: SceneType;
  data: any;

  onEnter?: () => void;
  onExit?: () => void;
}

class SceneManager {
  private currentScene: Scene | null = null;
  private sceneStack: Scene[] = [];

  // åˆ‡æ¢åœºæ™¯
  switchScene(sceneId: string, transition?: TransitionType) {
    const newScene = this.loadScene(sceneId);

    this.currentScene?.onExit?.();

    // æ‰§è¡Œè½¬åœºåŠ¨ç”»
    if (transition) {
      this.playTransition(transition);
    }

    this.currentScene = newScene;
    this.currentScene.onEnter?.();
  }

  // å‹æ ˆåœºæ™¯(ç”¨äºæš‚æ—¶åˆ‡æ¢åè¿”å›)
  pushScene(sceneId: string) {
    if (this.currentScene) {
      this.sceneStack.push(this.currentScene);
    }
    this.switchScene(sceneId);
  }

  // å¼¹å‡ºåœºæ™¯(è¿”å›ä¸Šä¸€ä¸ªåœºæ™¯)
  popScene() {
    const prevScene = this.sceneStack.pop();
    if (prevScene) {
      this.currentScene = prevScene;
      this.currentScene.onEnter?.();
    }
  }
}
```

### çŠ¶æ€ç®¡ç† (Zustand)

```typescript
// stores/useGameStore.ts
interface GameState {
  // æ¸¸æˆè¿›åº¦
  currentChapter: number;
  currentScene: string;

  // Flagç³»ç»Ÿ
  flags: Record<string, boolean>;
  variables: Record<string, any>;

  // ç»Ÿè®¡æ•°æ®
  playTime: number;
  choices: Choice[];

  // æ“ä½œ
  setFlag: (key: string, value: boolean) => void;
  setVariable: (key: string, value: any) => void;
  addPlayTime: (seconds: number) => void;
}

export const useGameStore = create<GameState>((set) => ({
  currentChapter: 1,
  currentScene: 'ch1_001',
  flags: {},
  variables: {},
  playTime: 0,
  choices: [],

  setFlag: (key, value) =>
    set((state) => ({
      flags: { ...state.flags, [key]: value }
    })),

  setVariable: (key, value) =>
    set((state) => ({
      variables: { ...state.variables, [key]: value }
    })),

  addPlayTime: (seconds) =>
    set((state) => ({
      playTime: state.playTime + seconds
    }))
}));

// stores/useDialogueStore.ts
interface DialogueState {
  currentNode: DialogueNode | null;
  history: string[];
  isAutoPlay: boolean;
  textSpeed: number;

  loadNode: (nodeId: string) => void;
  nextNode: () => void;
  makeChoice: (choiceIndex: number) => void;
  toggleAutoPlay: () => void;
}

// stores/useDeviceStore.ts
interface DeviceState {
  osType: 'mobile' | 'desktop';
  currentApp: string | null;
  notifications: Notification[];
  systemTime: Date;

  openApp: (appId: string) => void;
  closeApp: () => void;
  addNotification: (notif: Notification) => void;
}
```

---

## ğŸ“² ç§»åŠ¨ç«¯é€‚é…ç­–ç•¥

### å“åº”å¼è®¾è®¡

```tsx
// hooks/useDeviceDetect.ts
export const useDeviceDetect = () => {
  const [device, setDevice] = useState<'mobile' | 'tablet' | 'desktop'>('desktop');

  useEffect(() => {
    const checkDevice = () => {
      const width = window.innerWidth;
      if (width < 768) setDevice('mobile');
      else if (width < 1024) setDevice('tablet');
      else setDevice('desktop');
    };

    checkDevice();
    window.addEventListener('resize', checkDevice);
    return () => window.removeEventListener('resize', checkDevice);
  }, []);

  return device;
};

// ä½¿ç”¨ç¤ºä¾‹
const GameContainer = () => {
  const device = useDeviceDetect();

  return (
    <div className={device === 'mobile' ? 'mobile-layout' : 'desktop-layout'}>
      {/* ... */}
    </div>
  );
};
```

### è§¦æ‘¸æ‰‹åŠ¿

```tsx
import { useGesture } from '@use-gesture/react';

const DialogueBox = () => {
  const bind = useGesture({
    // å‘ä¸Šæ»‘åŠ¨ = ä¸‹ä¸€å¥
    onSwipeUp: () => {
      nextDialogue();
    },

    // é•¿æŒ‰ = æ‰“å¼€å†å²è®°å½•
    onLongPress: () => {
      openHistory();
    },

    // åŒå‡» = éšè—UI
    onDoubleClick: () => {
      toggleUI();
    }
  });

  return <div {...bind()}>å¯¹è¯å†…å®¹</div>;
};
```

### æ€§èƒ½ä¼˜åŒ–

```tsx
// 1. æ‡’åŠ è½½å›¾ç‰‡
const LazyImage = ({ src, alt }) => {
  return (
    <img
      src={src}
      alt={alt}
      loading="lazy"
      decoding="async"
    />
  );
};

// 2. è™šæ‹Ÿæ»šåŠ¨(é•¿åˆ—è¡¨)
import { useVirtualizer } from '@tanstack/react-virtual';

const MessageList = ({ messages }) => {
  const parentRef = useRef<HTMLDivElement>(null);

  const virtualizer = useVirtualizer({
    count: messages.length,
    getScrollElement: () => parentRef.current,
    estimateSize: () => 60
  });

  return (
    <div ref={parentRef} className="h-screen overflow-auto">
      {virtualizer.getVirtualItems().map((item) => (
        <div key={item.key} data-index={item.index}>
          <Message data={messages[item.index]} />
        </div>
      ))}
    </div>
  );
};

// 3. ä»£ç åˆ†å‰²
const WeChatApp = lazy(() => import('./apps/WeChat'));
const BrowserApp = lazy(() => import('./apps/Browser'));

<Suspense fallback={<LoadingSpinner />}>
  {currentApp === 'wechat' && <WeChatApp />}
</Suspense>
```

### PWAé…ç½®

```json
// public/manifest.json
{
  "name": "æ„é€ å±‚",
  "short_name": "æ„é€ å±‚",
  "description": "ä¸€æ¬¾æ²‰æµ¸å¼äº’åŠ¨å°è¯´æ¸¸æˆ",
  "start_url": "/",
  "display": "standalone",
  "background_color": "#000000",
  "theme_color": "#1a202c",
  "orientation": "portrait",
  "icons": [
    {
      "src": "/icons/icon-192.png",
      "sizes": "192x192",
      "type": "image/png"
    },
    {
      "src": "/icons/icon-512.png",
      "sizes": "512x512",
      "type": "image/png"
    }
  ]
}
```

---

## ğŸµ éŸ³æ•ˆä¸æ¼”å‡ºç³»ç»Ÿ

### éŸ³é¢‘ç®¡ç†å™¨

```typescript
class AudioManager {
  private bgm: HTMLAudioElement | null = null;
  private sePool: Map<string, HTMLAudioElement> = new Map();

  private bgmVolume = 0.7;
  private seVolume = 1.0;

  // æ’­æ”¾BGM
  playBGM(src: string, loop = true, fadeIn = true) {
    if (this.bgm) {
      this.stopBGM(fadeIn);
    }

    this.bgm = new Audio(src);
    this.bgm.loop = loop;
    this.bgm.volume = fadeIn ? 0 : this.bgmVolume;

    this.bgm.play();

    if (fadeIn) {
      this.fadeBGM(this.bgmVolume, 2000);
    }
  }

  // æ·¡å…¥æ·¡å‡º
  private fadeBGM(targetVolume: number, duration: number) {
    if (!this.bgm) return;

    const startVolume = this.bgm.volume;
    const startTime = Date.now();

    const fade = () => {
      if (!this.bgm) return;

      const elapsed = Date.now() - startTime;
      const progress = Math.min(elapsed / duration, 1);

      this.bgm.volume = startVolume + (targetVolume - startVolume) * progress;

      if (progress < 1) {
        requestAnimationFrame(fade);
      }
    };

    fade();
  }

  // æ’­æ”¾éŸ³æ•ˆ
  playSE(src: string) {
    const se = new Audio(src);
    se.volume = this.seVolume;
    se.play();

    se.onended = () => se.remove();
  }
}

export const audioManager = new AudioManager();
```

### ç‰¹æ•ˆç»„ä»¶

```tsx
// å±å¹•éœ‡åŠ¨
const ScreenShake = ({ intensity = 10, duration = 500 }) => {
  useEffect(() => {
    const element = document.body;
    const startTime = Date.now();

    const shake = () => {
      const elapsed = Date.now() - startTime;
      if (elapsed > duration) {
        element.style.transform = '';
        return;
      }

      const x = (Math.random() - 0.5) * intensity;
      const y = (Math.random() - 0.5) * intensity;
      element.style.transform = `translate(${x}px, ${y}px)`;

      requestAnimationFrame(shake);
    };

    shake();
  }, []);

  return null;
};

// åœºæ™¯è½¬åœº
const SceneTransition = ({ type, duration = 1000, onComplete }) => {
  return (
    <motion.div
      className="fixed inset-0 bg-black z-[9999] pointer-events-none"
      initial={{ opacity: type === 'fadeIn' ? 1 : 0 }}
      animate={{ opacity: type === 'fadeIn' ? 0 : 1 }}
      transition={{ duration: duration / 1000 }}
      onAnimationComplete={onComplete}
    />
  );
};

// æ‰“å­—æœºæ•ˆæœ
const TypewriterText = ({ text, speed = 50, onComplete }) => {
  const [displayedText, setDisplayedText] = useState('');
  const [currentIndex, setCurrentIndex] = useState(0);

  useEffect(() => {
    if (currentIndex < text.length) {
      const timer = setTimeout(() => {
        setDisplayedText((prev) => prev + text[currentIndex]);
        setCurrentIndex((prev) => prev + 1);
      }, speed);

      return () => clearTimeout(timer);
    } else {
      onComplete?.();
    }
  }, [currentIndex, text, speed]);

  return <span>{displayedText}</span>;
};
```

---

## ğŸ’¾ å­˜æ¡£ç³»ç»Ÿå®ç°

### IndexedDBå°è£…

```typescript
// utils/db.ts
import Dexie, { Table } from 'dexie';

interface SaveSlot {
  id: string;
  name: string;
  timestamp: Date;
  thumbnail?: string;
  data: SaveData;
}

class GameDatabase extends Dexie {
  saves!: Table<SaveSlot>;
  settings!: Table<{ key: string; value: any }>;
  achievements!: Table<{ id: string; unlocked: boolean; unlockedAt?: Date }>;

  constructor() {
    super('ConstructLayerDB');

    this.version(1).stores({
      saves: 'id, timestamp',
      settings: 'key',
      achievements: 'id'
    });
  }

  async createSave(slot: string, data: SaveData) {
    const save: SaveSlot = {
      id: slot,
      name: `å­˜æ¡£ - ${new Date().toLocaleString()}`,
      timestamp: new Date(),
      thumbnail: await this.captureScreenshot(),
      data
    };

    await this.saves.put(save);
  }

  async loadSave(slot: string): Promise<SaveData | null> {
    const save = await this.saves.get(slot);
    return save?.data || null;
  }

  async listSaves(): Promise<SaveSlot[]> {
    return await this.saves.orderBy('timestamp').reverse().toArray();
  }

  async deleteSave(slot: string) {
    await this.saves.delete(slot);
  }

  private async captureScreenshot(): Promise<string> {
    // ä½¿ç”¨ html2canvas æˆªå›¾
    // è¿”å› base64 å›¾ç‰‡
    return '';
  }
}

export const db = new GameDatabase();
```

### è‡ªåŠ¨å­˜æ¡£

```tsx
// hooks/useSaveLoad.ts
export const useAutoSave = () => {
  const gameState = useGameStore();
  const dialogueState = useDialogueStore();
  const deviceState = useDeviceStore();

  useEffect(() => {
    // æ¯5åˆ†é’Ÿè‡ªåŠ¨å­˜æ¡£
    const interval = setInterval(() => {
      saveGame('auto');
    }, 5 * 60 * 1000);

    return () => clearInterval(interval);
  }, []);

  // é‡è¦äº‹ä»¶è§¦å‘å­˜æ¡£
  useEffect(() => {
    const handleImportantEvent = (event: string) => {
      if (AUTO_SAVE_TRIGGERS.includes(event)) {
        saveGame('auto');
      }
    };

    EventBus.on('*', handleImportantEvent);
    return () => EventBus.off('*', handleImportantEvent);
  }, []);

  const saveGame = async (slot: string) => {
    const saveData: SaveData = {
      id: crypto.randomUUID(),
      timestamp: new Date(),
      chapterId: gameState.currentChapter,
      sceneId: gameState.currentScene,
      gameState: {
        flags: gameState.flags,
        variables: gameState.variables,
        filesOpened: gameState.filesOpened,
        achievements: gameState.achievements
      },
      deviceState: {
        currentOS: deviceState.osType,
        apps: deviceState.apps,
        notifications: deviceState.notifications
      },
      dialogueState: {
        currentNode: dialogueState.currentNode?.id || '',
        history: dialogueState.history,
        choices: dialogueState.choices
      },
      metadata: {
        playTime: gameState.playTime,
        saveCount: gameState.saveCount + 1,
        version: '1.0.0'
      }
    };

    await db.createSave(slot, saveData);
  };

  const loadGame = async (slot: string) => {
    const saveData = await db.loadSave(slot);
    if (!saveData) return false;

    // æ¢å¤çŠ¶æ€
    gameState.restore(saveData.gameState);
    dialogueState.restore(saveData.dialogueState);
    deviceState.restore(saveData.deviceState);

    return true;
  };

  return { saveGame, loadGame };
};
```

---

## ğŸ¯ å¼€å‘ä¼˜å…ˆçº§

### Phase 1: æ ¸å¿ƒæ¡†æ¶ (Week 1-2)
- [x] é¡¹ç›®åˆå§‹åŒ– (Vite + React + TypeScript)
- [ ] åŸºç¡€è·¯ç”±(æ¬¢è¿é¡µ â†’ æ¸¸æˆé¡µ)
- [ ] çŠ¶æ€ç®¡ç†(Zustand stores)
- [ ] IndexedDBå°è£…
- [ ] ç§»åŠ¨ç«¯æ£€æµ‹ä¸é€‚é…

### Phase 2: æ¬¢è¿é¡µç³»ç»Ÿ (Week 2-3)
- [ ] ä¸»èœå•UI
- [ ] å¼•å­åŠ¨ç”»
- [ ] ç« èŠ‚é€‰æ‹©
- [ ] å­˜æ¡£ç®¡ç†ç•Œé¢
- [ ] è®¾ç½®é¢æ¿

### Phase 3: å¯¹è¯ç³»ç»Ÿ (Week 3-4)
- [ ] DialogueBoxç»„ä»¶
- [ ] æ‰“å­—æœºæ•ˆæœ
- [ ] ç«‹ç»˜ç³»ç»Ÿ
- [ ] é€‰é¡¹åˆ†æ”¯
- [ ] å¯¹è¯å†å²

### Phase 4: è®¾å¤‡æ¨¡æ‹Ÿç³»ç»Ÿ (Week 4-6)
- [ ] æ‰‹æœºä¸»å±å¹•
- [ ] çŠ¶æ€æ /é€šçŸ¥æ 
- [ ] åº”ç”¨å®¹å™¨æ¡†æ¶
- [ ] å¾®ä¿¡æ¨¡æ‹Ÿ
- [ ] æµè§ˆå™¨æ¨¡æ‹Ÿ
- [ ] æ–‡ä»¶ç®¡ç†å™¨

### Phase 5: æˆå°±ä¸æ¼”å‡º (Week 6-7)
- [ ] æˆå°±ç³»ç»Ÿé€»è¾‘
- [ ] æˆå°±UI
- [ ] éŸ³æ•ˆç®¡ç†å™¨
- [ ] è½¬åœºæ•ˆæœ
- [ ] ç‰¹æ•ˆç»„ä»¶

### Phase 6: å†…å®¹å¡«å…… (Week 7-8)
- [ ] ç¬¬ä¸€ç« å¯¹è¯è„šæœ¬
- [ ] ç¬¬ä¸€ç« è®¾å¤‡å†…å®¹
- [ ] å›¾ç‰‡èµ„æº
- [ ] éŸ³é¢‘èµ„æº

### Phase 7: æµ‹è¯•ä¸ä¼˜åŒ– (Week 8-9)
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] Bugä¿®å¤
- [ ] ç”¨æˆ·æµ‹è¯•
- [ ] æ‰“åŒ…éƒ¨ç½²

---

## ğŸ“¦ æŠ€æœ¯ä¾èµ–æ¸…å•

```json
{
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-router-dom": "^6.20.0",
    "zustand": "^4.4.7",
    "framer-motion": "^10.16.16",
    "dexie": "^3.2.4",
    "dexie-react-hooks": "^1.1.7",
    "@use-gesture/react": "^10.3.0",
    "react-use": "^17.4.2",
    "@tanstack/react-virtual": "^3.0.1",
    "clsx": "^2.0.0",
    "date-fns": "^3.0.0"
  },
  "devDependencies": {
    "@types/react": "^18.2.45",
    "@types/react-dom": "^18.2.18",
    "@vitejs/plugin-react": "^4.2.1",
    "typescript": "^5.3.3",
    "vite": "^5.0.8",
    "tailwindcss": "^3.4.0",
    "autoprefixer": "^10.4.16",
    "postcss": "^8.4.32",
    "vite-plugin-pwa": "^0.17.4"
  }
}
```

---

## ğŸ¨ è®¾è®¡è§„èŒƒ

### è‰²å½©ç³»ç»Ÿ
```css
:root {
  /* ä¸»è‰²è°ƒ */
  --primary: #3b82f6;     /* è“è‰² */
  --secondary: #8b5cf6;   /* ç´«è‰² */
  --accent: #f59e0b;      /* æ©™è‰² */

  /* ä¸­æ€§è‰² */
  --gray-50: #f9fafb;
  --gray-900: #111827;

  /* è¯­ä¹‰è‰² */
  --success: #10b981;
  --warning: #f59e0b;
  --error: #ef4444;
  --info: #3b82f6;

  /* å¯¹è¯æ¡† */
  --dialogue-bg: rgba(0, 0, 0, 0.85);
  --dialogue-text: #ffffff;
}
```

### å­—ä½“è§„èŒƒ
```css
/* ä¸­æ–‡: æ€æºé»‘ä½“/è‹¹æ–¹ */
font-family:
  "PingFang SC",
  "Noto Sans SC",
  "Microsoft YaHei",
  sans-serif;

/* è‹±æ–‡/æ•°å­—: SF Pro */
font-family:
  -apple-system,
  BlinkMacSystemFont,
  "Segoe UI",
  sans-serif;
```

### ç§»åŠ¨ç«¯å°ºå¯¸
```
- å®‰å…¨åŒºåŸŸ: env(safe-area-inset-*)
- æœ€å°ç‚¹å‡»åŒºåŸŸ: 44x44px
- çŠ¶æ€æ é«˜åº¦: 44px
- å¯¼èˆªæ é«˜åº¦: 56px
- å¯¹è¯æ¡†é«˜åº¦: 30vh - 40vh
```

---

## ğŸ”š æ€»ç»“

è¿™ä»½æ¶æ„è®¾è®¡æ–‡æ¡£æä¾›äº†ä¸€ä¸ª**ç§»åŠ¨ç«¯ä¼˜å…ˆã€åŒç³»ç»Ÿèåˆ**çš„å®Œæ•´è§£å†³æ–¹æ¡ˆ:

âœ… **æ¬¢è¿é¡µç³»ç»Ÿ** - å®Œæ•´çš„èœå•ã€å­˜æ¡£ã€æˆå°±ã€è®¾ç½®
âœ… **å¯¹è¯ç³»ç»Ÿ** - Galgameé£æ ¼çš„è§†è§‰å°è¯´ä½“éªŒ
âœ… **è®¾å¤‡æ¨¡æ‹Ÿ** - é«˜åº¦è¿˜åŸçš„æ‰‹æœº/ç”µè„‘æ“ä½œç³»ç»Ÿ
âœ… **æˆå°±ç³»ç»Ÿ** - å¢åŠ æ¸¸æˆå¯ç©æ€§å’Œé‡ç©ä»·å€¼
âœ… **ç§»åŠ¨ä¼˜å…ˆ** - é’ˆå¯¹è§¦æ‘¸å±ä¼˜åŒ–çš„äº¤äº’è®¾è®¡
âœ… **æ€§èƒ½ä¼˜åŒ–** - æ‡’åŠ è½½ã€è™šæ‹Ÿæ»šåŠ¨ã€PWAæ”¯æŒ

ä¸‹ä¸€æ­¥å¯ä»¥ï¼š
1. å¼€å§‹æ­å»ºé¡¹ç›®è„šæ‰‹æ¶
2. å®ç°æ ¸å¿ƒçŠ¶æ€ç®¡ç†
3. åˆ›å»ºæ¬¢è¿é¡µåŸå‹
4. æˆ–ç»§ç»­å®Œå–„æŸä¸ªå…·ä½“ç³»ç»Ÿçš„è¯¦ç»†è®¾è®¡

éœ€è¦æˆ‘ç»§ç»­ç»†åŒ–å“ªä¸ªéƒ¨åˆ†çš„å®ç°ç»†èŠ‚ï¼Ÿ

---

**æ–‡ä»¶å**: `æ¸¸æˆç³»ç»Ÿæ•´ä½“æ¶æ„è®¾è®¡.md`
**ç‰ˆæœ¬**: v1.0
**æ›´æ–°æ—¥æœŸ**: 2024-12-14
